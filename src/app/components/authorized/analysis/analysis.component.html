<section class="page-body home-bodys">
  <div class="container">
    <div class="home-wrapper">
      <div class="clearfix my-community-body">
        <div class="home-panel">
          <app-progress-bar [message]="loaderMsg" class="page" *ngIf="isLoading"></app-progress-bar>
          <div class="shrare-post">
            <!-- Analysis by CDE-->
            <mat-card class="border no-rounded list shrare-post">
              <!-- <app-progress-bar [message]="loaderMsg" class="page" *ngIf="isLoadingDetails"></app-progress-bar> -->
              <div class="list flex-containers analysis-wrp tpBg2 flex-start wrap ">
                <div class="list-item-4 outline">
                  <h1 class="share-post-title">
                    Source: <span class="yellow"> {{selectedAnalysis.source?.sourceDataName}}</span>
                  </h1>
                </div>
                <div class="list-item-5 outline">
                  <mat-form-field appearance="fill">
                    <mat-label class="lbl">Ruleset Name</mat-label>
                      <mat-select [(ngModel)]="selectedAnalysis.rulesetId"  (ngModelChange)="onRulesetChange(selectedAnalysis.rulesetId)">
                        <mat-option *ngFor="let rule of selectedAnalysis.rules;" [value]="rule.rulesetId">
                            {{rule.rulesetName}}
                        </mat-option>
                      </mat-select>
                  </mat-form-field>
                </div>
                <div class="list-item-5 outline">
                  <mat-form-field appearance="fill">
                    <mat-select [(ngModel)]="selectedCDE" (ngModelChange)="launchAnalysisByKeyDate($event, uploadId)">
                      <mat-option *ngFor="let col of selectedColumns;" [value]="col">
                        {{col}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="list-item-3 outline">
                  <div class="act-btn-wrapper">
                    <button mat-stroked-button class="button3d btnPush btnPurple ebckBtn" (click)="gotoDashboard();"><mat-icon>keyboard_arrow_left</mat-icon> Back</button>
                  </div>
                </div>
              </div>

              <!-- Date Carousel -->
              <div class="analysis-info">
                <div class="category-list-wrapper clearfix">
                  <div class="left-arrow">
                     <button mat-stroked-button class="gv-secondary-btn primary-btn-gray prev-next-btn clr" (click)="owlCar.prev()">
                     <mat-icon class="pl">keyboard_arrow_left</mat-icon>
                     </button>
                  </div>
                  <div class="category-list" #carouselHolder>
                     <owl-carousel-o [options]="OwlCategoryOptions" #owlCar>
                     <!-- Carousel Items -->
                     <ng-container *ngFor="let history of uploadsHistory">
                        <ng-template carouselSlide [id]="history.uploadId">
                           <div class="category-item" [class.selected]="history.uploadId === uploadId" (tap)="tapDateCarouselItem(history)">
                           <h3 class="cat-title">{{formatDate(history.uploadDate)}}</h3>
                           </div>
                        </ng-template>
                     </ng-container>
                     </owl-carousel-o>
                  </div>
                  <div class="right-arrow">
                     <button mat-stroked-button class="gv-secondary-btn primary-btn-gray prev-next-btn" (click)="owlCar.next()">
                     <mat-icon class="pl">keyboard_arrow_right</mat-icon>
                     </button>
                  </div>
               </div>
              </div>
              <mat-tab-group mat-align-tabs="start"  animationDuration="0ms">
               <mat-tab label="2D Map">
                  <app-cylinder-chart 
                    *ngIf="analyseKeyData.length && isLoadChart"
                    [analysisKeys]="analysisKeys"
                    [chartData]="analyseKeyChartData"
                    [chartType]="'column'" 
                    [options3d]= false
                    (barClicked)="onBarClicked($event)"
                    >
                  </app-cylinder-chart>
                  
                </mat-tab>
               <mat-tab label="3D Map">
                  <app-cylinder-chart 
                  *ngIf="analyseKeyData.length && isLoadChart"
                  [analysisKeys]="analysisKeys"
                  [chartData]="analyseKeyChartData"
                  [chartType]="'column'" 
                  [options3d]= true
                  (barClicked)="onBarClicked($event)"
                  >
                  </app-cylinder-chart>
               </mat-tab>
               <mat-tab label="Analysis">
                <app-analysis-chart></app-analysis-chart>
               </mat-tab>
              </mat-tab-group>
              <div class="analysis-preview">
                <div class="actions-wrapper">
                  <button  class="horizontal" (click)="openHighlightSettingsDialog()"> 
                     <span class="text">
                        <mat-icon class="bt">format_color_fill</mat-icon> Highlight Color </span>
                  </button>

                  <!-- <button type="button" class="ma-cr" mat-icon-button matTooltip="Highlight Settings"  (click)="openHighlightSettingsDialog()">
                    <mat-icon>format_color_fill</mat-icon>
                  </button> -->
                </div>

                <!--<table mat-table [dataSource]="analyseKeyData" matSort class="mat-elevation-z8">
                  <div *ngFor="let column of displayedColumns">
                    <ng-container [matColumnDef]="column">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column}}</th>
                      <td mat-cell *matCellDef="let element">
                        <div *ngIf="!element[column].value">{{element[column]}}</div>
                        <div class="cell-wrp" [style.background-color]="element[column].value | formatCell: settings">
                          <div class="cur" 
                            *ngIf="element[column].value && element[column].details && element[column].details.length"
                            (click)="showDetails(element[column].details, column, selectedKey, element[column])"
                          >{{element[column].value}}%</div>
                          <div class="cur" 
                            *ngIf="element[column].value && (!element[column].details || (element[column].details && !element[column].details.length))"
                            (click)="showDetails(element[column].details, column, selectedKey, element[column])"
                          >{{element[column].value}}%</div>
                        </div>
                      </td>
                    </ng-container>
                  </div>
                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table> -->
            
                <ng-data-table
                  [id]="'sales_products_detail_summery'"
                  [title]="'Sales Products'"
                  [items]="dataTable"
                  [minContentHeight]="200"
                  [minContentWidth]="900"
                  [showHeader]="true"
                  [pageable]="true"
                  [showRefreshButton]="true"
                  [showRowSelectCheckbox]="true"
                  [rowSelectable]="true"
                  [selectOnRowClick]="true"
                  [showSubstituteRows]="true"
                  [persistTableState]="true"
                  [showColumnSelector]="true"
                  [expandableRows]="true"
                  [showLoadingSpinner]="true"
                  [selectMode]="'multi'"
                  [showRowSelectAllCheckbox]="true">
                    <ng-data-table-column
                      [field]="'id'"
                      [title]="'ID'"
                      [showInColumnSelector]="false"
                      [sortable]="true"
                      [filterable]="true"
                      [filterPlaceholder]="'Search'"
                      [width]="80">
                      <ng-template #ngDataTableCell let-row="row">
                        <td>
                          <span><i class="zmdi zmdi-account"></i></span>
                          <span>{{ row.item.id }}</span>
                        </td>
                      </ng-template>
                    </ng-data-table-column>
                    <ng-data-table-column
                      [field]="'orderMethodType'"
                      [title]="'Order Method Type'"
                      [sortable]="true"
                      [filterable]="true"
                      [showDropdownFilter]="true"
                      [dropdownFilterShowClearSelectionButton]="true"
                      [dropdownFilterSearchable]="true"
                      [dropDownFilterShowOptionSelectCheckbox]="true"
                      [filterPlaceholder]="'Search'"
                      [width]="130">
                    </ng-data-table-column>
                    <ng-data-table-column
                      [field]="'retailerType'"
                      [title]="'Retailer Type'"
                      [sortable]="true"
                      [filterable]="true"
                      [showDropdownFilter]="true"
                      [dropdownFilterShowClearSelectionButton]="true"
                      [dropdownFilterSearchable]="true"
                      [dropDownFilterShowOptionSelectCheckbox]="true"
                      [filterPlaceholder]="'Search'">
                    </ng-data-table-column>
                    <ng-data-table-column
                      [field]="'productLine'"
                      [title]="'Product Line'"
                      [sortable]="true"
                      [filterable]="true"
                      [visible]="false"
                      [filterPlaceholder]="'Search'">
                    </ng-data-table-column>
                    <ng-data-table-column
                      [field]="'productType'"
                      [title]="'Product Type'"
                      [sortable]="true"
                      [filterable]="true"
                      [showDropdownFilter]="true"
                      [dropdownFilterShowClearSelectionButton]="true"
                      [dropdownFilterSearchable]="true"
                      [dropDownFilterShowOptionSelectCheckbox]="true">
                      <ng-template #ngDataTableCell let-row="row">
                        <td>
                          <span>{{ row.item.productType.toUpperCase() }}</span>
                        </td>
                      </ng-template>
                    </ng-data-table-column>
                    <ng-data-table-column
                      [field]="'revenue'"
                      [title]="'Revenue'"
                      [sortable]="true"
                      [filterable]="true"
                      [filterPlaceholder]="'Search'"
                      [width]="90">
                    </ng-data-table-column>
                    <ng-data-table-column
                      [field]="'quantity'"
                      [title]="'Quantity'"
                      [sortable]="true"
                      [filterable]="true"
                      [filterPlaceholder]="'Search'"
                      [width]="80">
                    </ng-data-table-column>
                    <ng-data-table-column
                      [field]="'grossMargin'"
                      [title]="'Gross Margin'"
                      [sortable]="true"
                      [filterable]="true"
                      [filterPlaceholder]="'Search'"
                      [width]="95">
                    </ng-data-table-column>
               
              </ng-data-table>
                
                <table class="table brd-rt tableChart">
                  <thead>
                    <tr>
                      <th>{{selectedKey}}</th>
                      <th *ngFor="let key of analysisKeys">{{key}}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of analyseKeyData;">
                      <td>{{data[selectedKey]}}</td>
                      <td *ngFor="let key of analysisKeys" [style.background-color]="data[key]?.value | formatCell: settings">
                        <span class="cur" 
                          *ngIf="data[key]?.details && data[key]?.details.length"
                          (click)="showDetails(data[key]?.details, key, selectedKey, data[selectedKey])"
                        >{{data[key]?.value}}%</span>
                        <span *ngIf="!data[key]?.details.length">{{data[key]?.value}}%</span>
                      </td>
                    </tr>
                  </tbody>
                </table> -->
              </div>
            </mat-card>   
          </div>
        </div>
      </div> 
    </div>
  </div>
</section>
